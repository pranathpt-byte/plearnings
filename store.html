<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P-Learnings — Pvan Pattanam Live</title>
  <style>
    :root{--bg:#f3f6fa;--card:#fff;--accent:#0077cc;--success:#00b894}
    body{margin:0;font-family:Inter, Arial, sans-serif;background:var(--bg);color:#222}
    header{background:var(--card);padding:16px 20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.04)}
    header h1{margin:0;font-size:20px}
    .container{max-width:1100px;margin:28px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .btn{display:inline-block;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-success{background:var(--success);color:#fff}
    label{display:block;margin:10px 0 6px;font-size:14px}
    input[type=text],input[type=file],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ee}
    .small{font-size:13px;color:#666}
    .live-preview{width:100%;height:300px;background:#e9eef8;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .live-preview img{max-width:100%;height:100%;object-fit:cover}
    .owner-badge{display:inline-block;background:#222;color:#fff;padding:6px 10px;border-radius:999px;font-size:13px}
    .note{font-size:13px;color:#555;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <h1>P-Learnings <span class="small">/ Pvan Pattanam Live</span></h1>
    <div>
      <span class="owner-badge" id="userStatus">Guest</span>
    </div>
  </header>

  <div class="container">
    <div class="grid">
      <!-- Left: Live area -->
      <div>
        <div class="card">
          <h2>Live: missy</h2>
          <div class="live-preview" id="liveArea">
            <!-- Use uploaded file thumbnail or placeholder image -->
            <img id="placeholderImg" src="/mnt/data/original-4097d2ac77843f7030e1eec054278a2e.webp" alt="P-Learnings Live" />
            <div id="liveOverlay" style="position:absolute;text-align:center;pointer-events:none;">
              <!-- overlay shown when 'Go Live' is on -->
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
            <button class="btn btn-primary" id="watchBtn">Watch Live</button>
            <button class="btn" id="refreshBtn">Refresh</button>
            <span class="small" id="statusText">LIVE — Stream Active</span>
          </div>

          <p class="note">Only Pvan Pattanam owners can upload or start the live stream. Others can only watch.</p>
        </div>

        <div class="card" style="margin-top:18px">
          <h3>Chat / Comments</h3>
          <div id="chatBox" style="height:160px;overflow:auto;border-radius:8px;padding:8px;border:1px solid #eef2f6;background:#fafbff"></div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <input type="text" id="chatInput" placeholder="Say something..." />
            <button class="btn btn-primary" id="sendChat">Send</button>
          </div>
        </div>
      </div>

      <!-- Right: Owner panel + Upload -->
      <div>
        <div class="card">
          <h3>Quick Login (simulate owner)</h3>
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="type your name (e.g., pvan_owner)" />

          <label for="role">Role</label>
          <select id="role">
            <option value="guest">Guest / Student</option>
            <option value="owner">Owner (can upload)</option>
          </select>

          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn btn-success" id="loginBtn">Login</button>
            <button class="btn" id="logoutBtn">Logout</button>
          </div>

          <p class="small">To allow uploads only to Pvan Pattanam, select <strong>Owner</strong> role and login. This is a simple front-end demo — replace with real auth on server.</p>
        </div>

        <div class="card" style="margin-top:18px" id="uploadCard">
          <h3>Owner Upload / Start Live</h3>
          <p class="small">Only visible when logged in as <strong>Owner</strong>.</p>

          <label for="videoFile">Choose video to upload</label>
          <input type="file" id="videoFile" accept="video/*" />

          <label for="title">Stream Title</label>
          <input type="text" id="title" placeholder="Pvan Pattanam Live — Topic" />

          <label for="visibility">Visibility</label>
          <select id="visibility">
            <option value="pvan">missy(Owners only)</option>
            <option value="public">Public</option>
          </select>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn btn-success" id="uploadBtn">Upload & Publish</button>
            <button class="btn" id="startLiveBtn">Start Live (simulate)</button>
          </div>

          <p class="note">Files uploaded here are only accepted if you are the owner. In a real app the server must verify ownership before saving.</p>
        </div>

        <div class="card" style="margin-top:18px">
          <h3>Owner-only Streams</h3>
          <div id="ownerList">
            <p class="small">No owner streams yet.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Simple front-end-only logic to demonstrate owner-only uploads
    const userStatus = document.getElementById('userStatus');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const roleEl = document.getElementById('role');
    const usernameEl = document.getElementById('username');
    const uploadCard = document.getElementById('uploadCard');
    const uploadBtn = document.getElementById('uploadBtn');
    const startLiveBtn = document.getElementById('startLiveBtn');
    const liveArea = document.getElementById('liveArea');
    const placeholderImg = document.getElementById('placeholderImg');
    const statusText = document.getElementById('statusText');
    const ownerList = document.getElementById('ownerList');
    const watchBtn = document.getElementById('watchBtn');
    const chatBox = document.getElementById('chatBox');
    const sendChat = document.getElementById('sendChat');
    const chatInput = document.getElementById('chatInput');

    let currentUser = {name:'Guest', role:'guest'};
    let liveStream = null; // {owner, title, url}

    function updateUI(){
      userStatus.textContent = currentUser.role === 'owner' ? (currentUser.name || 'Owner') : 'Guest';
      uploadCard.style.display = currentUser.role === 'owner' ? 'block' : 'none';
    }

    loginBtn.addEventListener('click', ()=>{
      currentUser.name = usernameEl.value || 'OwnerUser';
      currentUser.role = roleEl.value;
      updateUI();
      appendChat(`${currentUser.name} logged in as ${currentUser.role}`);
    });
    logoutBtn.addEventListener('click', ()=>{
      currentUser = {name:'Guest', role:'guest'};updateUI();appendChat('Guest logged out');
    });

    uploadBtn.addEventListener('click', ()=>{
      if(currentUser.role !== 'owner'){alert('Only owners can upload to Pvan Pattanam.');return}
      const file = document.getElementById('videoFile').files[0];
      const title = document.getElementById('title').value || 'Untitled Stream';
      const visibility = document.getElementById('visibility').value;
      if(!file){alert('Select a video file first.');return}

      // In a real app: send FormData to server with owner token and server-side checks.
      const url = URL.createObjectURL(file);
      liveStream = {owner: currentUser.name, title, url, visibility};
      placeholderImg.src = url; // show uploaded thumbnail
      statusText.textContent = `Uploaded by ${currentUser.name}. Preview available.`;
      ownerList.innerHTML = `<div style="padding:8px;border-radius:8px;background:#fbfbff">${title} — uploaded by <strong>${currentUser.name}</strong></div>`;
      appendChat(`${currentUser.name} uploaded a new stream: ${title}`);
    });

    startLiveBtn.addEventListener('click', ()=>{
      if(currentUser.role !== 'owner'){alert('Only owners can start live.');return}
      const title = document.getElementById('title').value || 'Live now';
      liveStream = liveStream || {owner:currentUser.name, title, url:placeholderImg.src, visibility:'pvan'};
      liveStream.title = title;
      statusText.textContent = `LIVE — ${title} by ${currentUser.name}`;
      appendChat(`${currentUser.name} started live: ${title}`);
      // overlay text
      const overlay = document.getElementById('liveOverlay');
      overlay.innerHTML = `<div style="background:rgba(0,0,0,0.45);color:#fff;padding:8px 12px;border-radius:8px;">LIVE • ${title}</div>`;
    });

    watchBtn.addEventListener('click', ()=>{
      if(!liveStream){alert('No stream active.');return}
      window.open(liveStream.url,'_blank');
    });

    sendChat.addEventListener('click', ()=>{
      const txt = chatInput.value.trim(); if(!txt) return; appendChat((currentUser.name||'Guest')+': '+txt); chatInput.value='';
    });

    function appendChat(msg){
      const p = document.createElement('div'); p.textContent = msg; p.style.padding='6px 0'; chatBox.appendChild(p); chatBox.scrollTop = chatBox.scrollHeight;
    }

    // initialize
    updateUI();
  </script>
</body>
</html>
